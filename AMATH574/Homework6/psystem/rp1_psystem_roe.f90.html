<!-- **** DO NOT EDIT THIS FILE *** 
         This file was generated automatically from file
              rp1_psystem_roe.f90
         using $CLAW/clawutil/src/python/clawutil/clawcode2html.py         -->

<html>
<title> rp1_psystem_roe.f90.html </title>


          <head>
           <link rel="icon" href="http://www.clawpack.org//_static/clawicon_new.ico" />
          </head> 
           <BODY TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#0000FF" 
                 VLINK="#5500DD" ALINK="#FF0000">
           <font FACE="HELVETICA,ARIAL">
           
<!-- Created from the file /home/cade/Homework/AMATH574/Homework6/psystem/rp1_psystem_roe.f90 -->
<!-- Date: Mon Feb 27 2023 at 15:22:23 -->

<table bgcolor="#FFEE99"> <tr> <td>
&nbsp;<font size=6> rp1_psystem_roe.f90.html </font> </td>

            <td><a href="http://www.clawpack.org/index.html"><img
            src="http://www.clawpack.org//_static/clawlogo_border.jpg"
            width=150 alt="CLAWPACK"></a>&nbsp;&nbsp; </td> </tr> <tr> <td>
&nbsp;Source file: &nbsp;&nbsp;<a href="rp1_psystem_roe.f90">rp1_psystem_roe.f90 </a>
</td></tr><tr><td>
&nbsp;Directory:  &nbsp; /home/cade/Homework/AMATH574/Homework6/psystem 
</td></tr><tr><td>
&nbsp;Converted:  &nbsp; Mon Feb 27 2023 at 15:22:23 
&nbsp; using <a href="http://www.clawpack.org//doc/application_documentation.html#clawcode2html">clawcode2html</a>
</td></tr><tr><td>
<font color="#BB3300"> &nbsp;This documentation file will 
not reflect any later changes in the source file. </font>
</td></tr></table></font>
<p>
<pre> 
<font color="blue">! =========================================================</font>
subroutine rp1(maxmx,meqn,mwaves,maux,mbc,mx,ql,qr,auxl,auxr,wave,s,amdq,apdq)
<font color="blue">! =========================================================</font>

<font color="blue">! Solve Riemann problems for the p-system</font>
<font color="blue">!   v_t - u_x = 0</font>
<font color="blue">!   u_t + (p(v))_x = 0</font>
<font color="blue">! using Roe's approximate Riemann solver.</font>

<font color="blue">! The function p(v) is specified in setprob_module.f90</font>

<font color="blue">! Note that the characteristic speeds are:</font>
<font color="blue">!     lambda^1 = -sqrt(exp(v)) and lambda^2 = +sqrt(exp(v)).</font>
<font color="blue">! so there is always 1 left-going and 1 right-going wave, </font>
<font color="blue">! and an entropy fix is never needed.</font>

<font color="blue">! waves: 2</font>
<font color="blue">! equations: 2</font>

<font color="blue">! Conserved quantities:</font>
<font color="blue">!       1 v = specific volume</font>
<font color="blue">!       2 u = velocity</font>

<font color="blue">! This function solves the Riemann problem at all interfaces in one call</font>

<font color="blue">! On input, ql contains the state vector at the left edge of each cell</font>
<font color="blue">!           qr contains the state vector at the right edge of each cell</font>
<font color="blue">! On output, wave contains the waves,</font>
<font color="blue">!            s the speeds,</font>
<font color="blue">!            amdq the  left-going flux difference  A^- \Delta q</font>
<font color="blue">!            apdq the right-going flux difference  A^+ \Delta q</font>

<font color="blue">! Note that the i'th Riemann problem has left state qr(:,i-1)</font>
<font color="blue">!                                    and right state ql(:,i)</font>
<font color="blue">! From the basic clawpack routine step1, rp is called with ql = qr = q.</font>


    use setprob_module, only: p  <font color="blue">! function defining p(v)</font>

    implicit none

    integer, intent(in) :: maxmx, meqn, mwaves, maux, mbc, mx
    real(kind=8), intent(in), dimension(meqn,1-mbc:maxmx+mbc) :: ql, qr
    real(kind=8), intent(in), dimension(maux,1-mbc:maxmx+mbc) :: auxl, auxr
    real(kind=8), intent(out) :: s(mwaves, 1-mbc:maxmx+mbc)
    real(kind=8), intent(out) :: wave(meqn, mwaves, 1-mbc:maxmx+mbc)
    real(kind=8), intent(out), dimension(meqn,1-mbc:maxmx+mbc) :: amdq,apdq

    <font color="blue">! local variables:</font>
    real(kind=8) :: alpha1,alpha2,cbar,vim,vi,uim,ui,dpdv
    real(kind=8) :: delta(2)
    integer :: i,m,mw


    <font color="blue">! # Main loop of the Riemann solver.</font>
    do 30 i=2-mbc,mx+mbc
    
        <font color="blue">! # compute  Roe-averaged quantities:</font>
        vim = qr(1,i-1)
        uim = qr(2,i-1)
        vi = ql(1,i)
        ui = ql(2,i)
        if (abs(vi-vim) > 1e-8) then
            dpdv = (p(vi) - p(vim)) / (vi - vim)
          else
            dpdv = (p(vi+1e-8) - p(vim)) / 1e-8
          endif
        
        cbar = sqrt(-dpdv)
                 
        delta(1) = ql(1,i) - qr(1,i-1)
        delta(2) = ql(2,i) - qr(2,i-1)

        <font color="blue">! # Compute coeffs in the evector expansion of delta(1),delta(2)</font>
        alpha1 = 0.5d0*(cbar*delta(1) + delta(2))/cbar
        alpha2 = 0.5d0*(cbar*delta(1) - delta(2))/cbar

        <font color="blue">! # Finally, compute the waves.</font>
        wave(1,1,i) = alpha1
        wave(2,1,i) = alpha1*cbar
        s(1,i) = -cbar
                 
        wave(1,2,i) = alpha2
        wave(2,2,i) = -alpha2*cbar
        s(2,i) = cbar
                 
    30 enddo

    <font color="blue">! # Compute fluctuations amdq and apdq</font>
    <font color="blue">! ------------------------------------</font>

    <font color="blue">! # amdq = SUM s*wave   over left-going waves</font>
    <font color="blue">! # apdq = SUM s*wave   over right-going waves</font>

    do m=1,2
        do i=2-mbc, mx+mbc
            amdq(m,i) = s(1,i)*wave(m,1,i)
            apdq(m,i) = s(2,i)*wave(m,2,i)
        enddo
    enddo
    
    end subroutine rp1

</pre></html>
